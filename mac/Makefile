
.PHONY: update upgrade install-packages clean

PACKAGE_LIST_FILE := brew_packages.txt

update:
	@echo "ğŸ¤– Running brew update"
	brew update

upgrade:
	@echo "ğŸ¤– Running brew upgrade"
	brew upgrade

install-packages:
	@echo "ğŸ¤– Installing Homebrew packages"
	@while IFS= read -r package; do \
		echo "ğŸ¤– Installing $$package"; \
		brew install $$package; \
	done < $(PACKAGE_LIST_FILE)

clean:
	@echo "ğŸ§¹ Removing Homebrew packages not in $(PACKAGE_LIST_FILE)"
	@INSTALLED_PACKAGES=$$(brew list --formula); \
	for package in $$INSTALLED_PACKAGES; do \
		if grep -qxF "$$package" "$(PACKAGE_LIST_FILE)"; then \
			echo "ğŸ”‘ Keeping $$package"; \
			continue; \
		else \
		echo "ğŸ§¹ Uninstalling $$package"; \
		brew uninstall $$package; \
		fi \
	done;
	@echo "ğŸ‘ğŸ¾ Sync complete."
