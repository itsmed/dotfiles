
.PHONY: install-brew update upgrade-packages install-packages clean

PACKAGE_LIST_FILE := brew_packages.txt

install-brew:
	@echo "ğŸ•µğŸ¾â€â™‚ï¸ Checking if x-tools is installed"
	xcode-select --install 2>/dev/null || echo "âœ…X-Tools already installed"
	@echo "ğŸ•µğŸ¾â€â™‚ï¸ Checking if Homebrew is installed"
	@if command -v brew >/dev/null; then \
		echo "âœ… $$(brew --version) installed"; \
	else \
		echo "ğŸ‘€ Homebrew not installed, installing now"; \
		/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"; \
	fi
	@if command -v brew >/dev/null; then \
		echo "âœ… Homebrew installed"; \
	else \
		echo "ğŸ¤” Something went wrong"; \
	fi

update:
	@echo "ğŸ¤– Running brew update"
	brew update

upgrade-packages:
	@echo "ğŸ¤– Running brew upgrade"
	brew upgrade

install-packages:
	@echo "ğŸ¤– Installing Homebrew packages"
	@while IFS= read -r package; do \
		echo "ğŸ¤– Installing $$package"; \
		brew install $$package; \
	done < $(PACKAGE_LIST_FILE)

clean:
	@echo "ğŸ§¹ Removing Homebrew packages not in $(PACKAGE_LIST_FILE)"
	@INSTALLED_PACKAGES=$$(brew list --formula); \
	for package in $$INSTALLED_PACKAGES; do \
		if grep -qxF "$$package" "$(PACKAGE_LIST_FILE)"; then \
			echo "ğŸ”‘ Keeping $$package"; \
			continue; \
		else \
		echo "ğŸ§¹ Uninstalling $$package"; \
		brew uninstall $$package; \
		fi \
	done;
	@echo "ğŸ‘ğŸ¾ Sync complete."
